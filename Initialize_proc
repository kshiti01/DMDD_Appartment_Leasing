---------------User Apt Booking---------------------
create or replace PROCEDURE BOOKAPTS(user_id in NUMBER, aid in NUMBER, mgid in NUMBER, bkng_fees in NUMBER, bkng_status in CHAR,bkng_date in date)
	AS
    aid1 number;
    bkng_failed EXCEPTION;
	BEGIN
	dbms_output.put_line('----------------------------------------------------------');
	IF(bkng_status='B' and bkng_fees>500)
	THEN
    insert into BOOKING(user_id,aid,mgid,booking_fees,booking_status,booking_date) values (user_id,aid,mgid,bkng_fees,bkng_status,bkng_date);
	select aid into aid1 from APARTMENT_DETAILS where aid=aid;
    update APARTMENT_DETAILS set AVAILABILITY ='N' where aid=aid;
    update lease_details set IS_ACTIVE='Y' where aid=aid1;
	dbms_output.put_line('Booking for '||aid||'successfully compeleted');
	dbms_output.put_line('----------------------------------------------------------');
	commit;
	ELSE
	raise bkng_failed;
	END IF;
    exception
    WHEN NO_DATA_FOUND THEN
    dbms_output.put_line('----------------------------------------------------------');
    DBMS_OUTPUT.PUT_LINE('Please select valid apartment for booking!');
	when bkng_failed then
	dbms_output.put_line('Please input appropriate Booking status ');
	when others then
	dbms_output.put_line(SQLERRM);
	dbms_output.put_line('Please provide the correct values for apartment booking!');
	rollback;
	end;
/

-------------Mgmt Add Apt details-------------------------
create or replace PROCEDURE MGMT_ADD_NEW_APTS(AVAILABILITY in VARCHAR2,NO_OF_TENANTS in NUMBER,BUILDING_TYPE in VARCHAR2,BUILT_YEAR in NUMBER,LOCATION in VARCHAR2,UNIT_NO in NUMBER,SQT_AREA in NUMBER,BUILDING_NO in NUMBER,AC_SYSTEM in CHAR,HEATER_SYSTEM in CHAR,HOT_WATER in CHAR,GAS_CONNECTION in CHAR,ELECTRICITY in CHAR,ASBESTOS in CHAR,REFRIGARATOR in CHAR,NO_OF_BEDROOMS in CHAR,FLOOR_NO in NUMBER,PARKING_AVAILABLE in CHAR,NO_OF_KEYS in NUMBER,OVEN in CHAR,STATUS_KEYLOCK in CHAR,STATUS_WINDOWS in CHAR,STATUS_DOOR in CHAR,STATUS_TOILETSINK in CHAR,STATUS_WASHSINK in CHAR,OWNER_NAME in VARCHAR2,SPECIAL_DESCRIPTION in VARCHAR2,NO_OF_BATHROOMS in NUMBER,NO_OF_BALCONY in VARCHAR2,BROKER_COMMISSION in NUMBER,MGID in NUMBER)
AS
add_failed EXCEPTION;
BEGIN
dbms_output.put_line('----------------------------------------------------------');
IF(AVAILABILITY='Y')
THEN
insert into APARTMENT_DETAILS(AVAILABILITY,NO_OF_TENANTS,BUILDING_TYPE,BUILT_YEAR,LOCATION,UNIT_NO,SQT_AREA,BUILDING_NO,AC_SYSTEM,HEATER_SYSTEM,HOT_WATER,GAS_CONNECTION,
ELECTRICITY,ASBESTOS,REFRIGARATOR,NO_OF_BEDROOMS,FLOOR_NO,PARKING_AVAILABLE,NO_OF_KEYS,OVEN,STATUS_KEYLOCK,STATUS_WINDOWS,STATUS_DOOR,STATUS_TOILETSINK,STATUS_WASHSINK,OWNER_NAME,SPECIAL_DESCRIPTION,NO_OF_BATHROOMS,NO_OF_BALCONY,BROKER_COMMISSION,MGID) values (AVAILABILITY,
NO_OF_TENANTS,BUILDING_TYPE,BUILT_YEAR,LOCATION,UNIT_NO,SQT_AREA,BUILDING_NO,AC_SYSTEM,HEATER_SYSTEM,HOT_WATER,GAS_CONNECTION,ELECTRICITY,ASBESTOS,REFRIGARATOR,
NO_OF_BEDROOMS,FLOOR_NO,PARKING_AVAILABLE,NO_OF_KEYS,OVEN,STATUS_KEYLOCK,STATUS_WINDOWS,STATUS_DOOR,STATUS_TOILETSINK,STATUS_WASHSINK,OWNER_NAME,SPECIAL_DESCRIPTION,NO_OF_BATHROOMS,NO_OF_BALCONY,BROKER_COMMISSION,MGID);

dbms_output.put_line('New Apartments successfully Added for'||MGID);
dbms_output.put_line('----------------------------------------------------------');
commit;
ELSE
raise add_failed;
END IF;
exception
when add_failed then
dbms_output.put_line('You can add a new apartment only if it is avaliable!! ');
when others then
dbms_output.put_line(SQLERRM);
dbms_output.put_line('Please provide the correct values for apartment booking!');
rollback;
end;
/

--------------------INSERT NEW LEASE DETAILS-----------------------
create or replace PROCEDURE INSRT_NEW_LEASE_DETAILS(l_type in CHAR, l_start_date in DATE,l_end_date in DATE, is_sub_allowed in CHAR, sub_charges in NUMBER, is_active in CHAR,sec_deposit in NUMBER, bal_amt in NUMBER, dat_created in DATE, rent in NUMBER, is_cancel_allowed in CHAR,cancel_charges in NUMBER, cancel_status in VARCHAR, is_ext_allowed in CHAR, ext_status in CHAR,ext_charges in NUMBER, ext_comments in VARCHAR, new_start_dat in DATE, new_end_dat in DATE, new_rent in NUMBER,aid in NUMBER)
AS
new_lease_failed EXCEPTION;
BEGIN
dbms_output.put_line('----------------------------------------------------------');
IF(is_active='N')
THEN
insert into INSRT_NEW_LEASE_DETAILS(LEASE_TYPE,LEASE_START_DATE,LEASE_END_DATE,IS_SUBLET_ALLOWED,SUBLETTING_CHARGES,IS_ACTIVE,SECURITY_DEPOSIT,BALANCE_AMOUNT,DATE_CREATED,RENT,IS_CANCELLATION_ALLOWED,CANCELLATION_CHARGES,CANCEL_STATUS,IS_EXTENSION_ALLOWED,EXTENSION_STATUS,EXTENSION_CHARGES,EXTENSION_COMMENTS,NEW_START_DATE,NEW_END_DATE,NEW_RENT,AID) values (l_type,l_start_date,l_end_date,is_sub_allowed,sub_charges,is_active,sec_deposit,bal_amt,dat_created,rent,is_cancel_allowed,cancel_charges,cancel_status,is_ext_allowed,ext_status,ext_charges,ext_comments,new_start_dat,new_end_dat,new_rent,aid);
dbms_output.put_line('New Lease Added successfully for apartment'||aid);
dbms_output.put_line('----------------------------------------------------------');
commit;
ELSE
raise new_lease_failed;
END IF;
exception
when new_lease_failed then
dbms_output.put_line('Please verify lease status before adding!');
when others then
dbms_output.put_line(SQLERRM);
dbms_output.put_line('Please provide the correct values for apartment booking!');
rollback;
end;
